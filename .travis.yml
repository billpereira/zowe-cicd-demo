language: node_js
node_js: v8.16.1
sudo: required

before_install:
  - npm config set @brightside:registry https://api.bintray.com/npm/ca/brightside
  - npm install -g @brightside/core@lts-incremental
  - zowe --version
  - zowe profiles cre zosmf-profile CICD --host $ZOSMF_HOST --port $ZOSMF_PORT --user $ZOSMF_USER --password $ZOSMF_PW --reject-unauthorized false

script:
  - if [ "$TRAVIS_BRANCH" != "master" ]; then node scripts/createTestJobs.js ; fi
  - if [ "$TRAVIS_BRANCH" != "master" ]; then npm run test ; fi
  - if [ "$TRAVIS_BRANCH" = "master" ]; then npm run deploy ; fi
  - >
    if [ "$TRAVIS_BRANCH" != "master" ]; 
    curl “https://ibmpb3.service-now.com/api/x_ibmg5_devops_cic/v1/cdci” 
    --request POST 
    --header “Accept:application/json” 
    --header “Content-Type:application/json” 
    --data “{\“assignment_group\“:\“Software\“,\“assigned_to\“:\“Thiago Gomes Muntoreanu\“,\“crq_status\“:\“\”,\“request_status\“:\“\”,\“request_summary\“:\“CDCI new JCL and Cobol\“}” 
    --user ‘admin’:‘admin’  ; 
    fi